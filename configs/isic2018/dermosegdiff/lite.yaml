run:
  device: 'cuda'
  save_imgs: "saved_imgs"
  writer_dir: "/mnt/mmlab2024nas/danh/hoangdv/LiteDermoSegDiff/ISIC2018/logs" # tensorboard runs
  continue_training: false # whether to continue the training from the last epoch it was saved

model:
  save_dir: "/mnt/mmlab2024nas/danh/hoangdv/LiteDermoSegDiff/ISIC2018/model"
  name: 'dsd_p01_9M_0.3' # the model will save and load with this config associated with this name.
  class: 'LiteDermoSegDiff' # student model class
  # Teacher configuration (explicit to avoid shape mismatches)
  teacher_checkpoint: "/mnt/mmlab2024nas/danh/hoangdv/DermoSegDiff/ISIC2018/model/n-dsd_i01_s-128_b-16_t-250_sc-linear_best.pth"
  teacher_use_ckpt_config: false
  teacher_class: 'DermoSegDiff'
  teacher_params:
    dim_x: 64
    dim_g: 32
    channels_x: 1
    channels_g: 3
    out_dim: 1
    dim_x_mults: [1, 2, 3, 4, 5, 6]
    dim_g_mults: [1, 2, 4, 8, 16, 32]
    resnet_block_groups: 8
  # Student configuration - compressed architecture based on Simple Diffusion principles
  params:
    dim_x: 64        # Reduced base dimensions
    dim_g: 32        # Reduced base dimensions  
    channels_x: 1 # mask
    channels_g: 3 # rgb-image
    out_dim: 1
    dim_x_mults: [1, 2, 3]  # Explicit x multipliers
    dim_g_mults: [1, 2, 4]  # Explicit g multipliers
    resnet_block_groups: 4 # Reduced GN groups
    use_separable_conv: false  # Use depthwise separable convs

diffusion:
  schedule:
    timesteps: 250
    mode: "linear" # options: [linear, quadratic, cosine, sigmoid]
    beta_start: 0.0004
    beta_end: 0.08

dataset:
  input_size: 128
  name: "isic2018"
  class_name: "ISIC2018DatasetFast" # do not change it unless you implement a new. this <Fast> class loads all files into ram at once to speed up data loading.
  data_dir: "/mnt/mmlab2024nas/danh/hoangdv/isic2018" # inside of this folder must exist <ISIC2018_Task1-2_Training_Input> and <ISIC2018_Task1_Training_GroundTruth> folders. Inside of this folder the required numpy files will create inside of <np> folder.
  number_classes: 2
  img_channels: 3
  msk_channels: 1
  # data_scale: "full"

data_loader:
  train: 
    batch_size: 16
    shuffle: true
    # num_workers: 16
    pin_memory: true
  validation: 
    batch_size: 16
    shuffle: false
    # num_workers: 16
    pin_memory: true
  test:
    batch_size: 16
    shuffle: false
    # num_workers: 16
    pin_memory: false

training:
  epochs: 2000
  intial_weights:
    use: false
    file_path: "path/to/file"
  loss: # Enhanced Knowledge Distillation with multiple state-of-the-art methods
    # 1. Base L2 loss (for stability)
    l2:
      coefficient: 1.0
      
    # 2. Progressive Distillation (Salimans et al.)
        
    # 3. Boundary-Privileged KD (BPKD)
    boundary_privileged_kd:
      coefficient: 0.25
      params:
        edge_weight: 5.0
        body_weight: 2.0
        edge_threshold: 0.3
        temperature: 1.0
        
    # Boundary & Context KD (BCKD) removed as requested
        
    # Graph Relation Distillation removed as requested
        
    # 6. Standard KD loss
        
    # 7. Original boundary loss
    boundary:
      coefficient: 0.25
      params:
        gamma: 0.2
        root: "l2"
        
  optimizer:
    name: 'Adam' # options: ["Adam", "SGD", "AdamW"]
    params:
      lr: 0.0002
      betas: [0.7, 0.99]
      weight_decay: 0.0
      
  scheduler: # lr_scheduler.ReduceLROnPlateau
    factor: 0.5
    patience: 10
    verbose: true
    
  ema: # https://github.com/lucidrains/ema-pytorch
    use: true
    params:
      beta: 0.9999
      update_after_step: 500
      update_every: 1
      inv_gamma: 1.0 # inv_gamma (float): Inverse multiplicative factor of EMA warmup. Default: 1.
      power: 0.9 # power (float): Exponential factor of EMA warmup. Default: 1.

testing:
  ensemble: 9
  model_weigths:
    overload: true
     # change to <true> if you want to test with the below checkpoint weights
    file_path: "/mnt/mmlab2024nas/danh/hoangdv/LiteDermoSegDiff/ISIC2018/model/n-dsd_p01_9M_0.5_s-128_b-16_t-250_sc-linear_best_best.pth"
  result_imgs:
    save: true # whether to save the test images generated by model for post-processing
    dir: "/mnt/mmlab2024nas/danh/hoangdv/LiteDermoSegDiff/ISIC2018/image"

augmentation:
  p: 0.7
  levels:
    pixel:
      p: 1.0
      transforms:
        CLAHE:
          clip_limit: 6
          tile_grid_size: [5, 5]
          p: 0.2
        Emboss:
          p: 0.2
        GaussNoise:
          var_limit: [50, 400]
          p: 0.2
        HueSaturationValue:
          hue_shift_limit: 15
          sat_shift_limit: 50
          val_shift_limit: 30
          p: 0.2
        MultiplicativeNoise:
          multiplier: [0.6, 1.5]
          elementwise: true
          p: 0.2
        RGBShift:
          p: 0.2
        RandomBrightnessContrast:
          brightness_limit: 0.3
          contrast_limit: 0.3
          p: 0.2
        RandomGamma:
          gamma_limit: [50, 150]
          p: 0.2
        RandomToneCurve:
          scale: 0.25
          p: 0.2
        Sharpen:
          alpha: 0.5
          lightness: 1.0
          p: 0.2
        Spatter:
          mean: 0
          std: 80
          gauss_sigma: 3
          cutout_threshold: 7
          intensity: -5
          p: 0.2
        UnsharpMask:
          blur_limit: 7
          p: 0.2

    spacial:
      p: 1
      transforms:
        Affine:
          scale: [0.8, 1.2]
          rotate: [-25, 25]
          shear: [-10, 10]
          p: 0.2
        CoarseDropout:
          min_holes: 2
          max_holes: 10
          min_height: 6
          max_height: 24
          min_width: 6
          max_width: 24
          fill_value: [0, 50, 100]
          p: 0.2
        ElasticTransform:
          alpha: 1.0
          sigma: 2.0
          alpha_affine: 30
          border_mode: 2
          p: 0.2
        HorizontalFlip:
          p: 0.2
        VerticalFlip:
          p: 0.1
        Flip:
          p: 0.2
        GridDistortion:
          distort_limit: 0.4
          border_mode: 4
          p: 0.2
        PiecewiseAffine:
          scale: 0.04
          p: 0.2
        PixelDropout:
          dropout_prob: 0.1
          p: 0.2
        RandomRotate90:
          p: 0.2
        Rotate:
          limit: 30
          border_mode: 4
          p: 0.2





